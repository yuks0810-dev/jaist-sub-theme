# クラウドインフラストラクチャのリソース割り当て問題

### シナリオ

あるサービスのインフラ担当エンジニアとして、複数のアプリケーション（Webフロントエンド、APIサーバー、データ処理バッチなど）をクラウド環境にデプロイする必要があります。各アプリケーションは安定稼働のために最低限必要なCPUコア数、メモリ量、ディスク容量が異なります。クラウドプロバイダーは、異なるスペックと月額料金を持つインスタンスタイプを提供しています。

### 目的

全てのアプリケーションの要求リソースを満たしながら、月額の総インスタンスコストを最小化するインスタンスの組み合わせを見つけることです。具体的には、「どのタイプのインスタンスを、どのアプリケーションのために、どの可用性ゾーンに、何台ずつ使用するか」を決定します。

## 数理モデル
### 目的関数

総月額コストの最小化

### 制約条件

1. **CPU要求充足**: 各アプリケーション $a$ について、割り当てられた全インスタンスのCPUコア数の合計が、最低要求CPU以上
3. **ディスク要求充足**: 各アプリケーション $a$ について、割り当てられた全インスタンスのディスク容量の合計が、最低要求ディスク以上
4. **最低インスタンス数**: 各アプリケーション $a$ について、割り当てられたインスタンスの合計台数が最低インスタンス数以上
5. **AZ分散**: AZ分散が必要なアプリケーション $a \in DistApps$ については、各可用性ゾーン $z$ に少なくとも1台のインスタンスを配置
6. **TypeD利用上限**: TypeDインスタンスの総使用台数に上限あり

## データ構造

### 基本データ
- `Apps`: アプリケーションの集合（例: "App1", "App2", "App3"）
- `Types`: インスタンスタイプの集合（例: "TypeA", "TypeB", "TypeC", "TypeD"）
- `AZs`: 可用性ゾーンの集合（例: "AZ-A", "AZ-B"）
- `DistApps`: AZ分散が必要なアプリケーションの集合（Appsのサブセット）

### リソース関連データ
- `cost[Types]`: 各インスタンスタイプの月額コスト
- `cpu[Types]`: 各インスタンスタイプのCPUコア数
- `mem[Types]`: 各インスタンスタイプのメモリ量
- `disk[Types]`: 各インスタンスタイプのディスク容量
- `req_cpu[Apps]`: 各アプリケーションの最低要求CPUコア数
- `req_mem[Apps]`: 各アプリケーションの最低要求メモリ量
- `req_disk[Apps]`: 各アプリケーションの最低要求ディスク容量
- `min_inst_per_app[Apps]`: 各アプリケーションに必要な最低インスタンス台数
- `max_typeD`: 利用可能なTypeDインスタンスの最大合計台数

## 重要事項

- 1つのインスタンスは、同時に1つのアプリケーションのみに使用（インスタンスの共有は不可）
- 1つのアプリケーションは、複数のインスタンス（同じタイプでも、異なるタイプでも可）を使用可能
- ハイアベイラビリティのため、特定のアプリケーションは複数の可用性ゾーンに分散配置する必要あり

## ファイル構成

- `12_cloud-infrastructure-resource-allocation.mod` - 最適化モデルファイル（OPL形式）
- `12_cloud-infrastructure-resource-allocation.dat` - 基本データファイル
- `data1.dat`, `data2.dat`, `data3.dat` - さまざまなシナリオのデータファイル
